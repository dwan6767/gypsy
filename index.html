<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESP Live Content</title>
</head>
<body>
<div id="espContent"></div>

<script>
  async function loadESPContent() {
    const container = document.getElementById('espContent');
    try {
      const resp = await fetch('/api/update');
      const data = await resp.json();

      if(data.html && data.html.trim() !== "") {
        container.innerHTML = data.html;

        // Execute any inline scripts
        const scripts = container.querySelectorAll('script');
        scripts.forEach(oldScript => {
          const newScript = document.createElement('script');
          if(oldScript.src) newScript.src = oldScript.src;
          else newScript.textContent = oldScript.textContent;
          document.body.appendChild(newScript);
        });
      } else {
        container.innerHTML = '';
      }
    } catch (e) {
      container.innerHTML = '';
    }
  }

  loadESPContent();
  setInterval(loadESPContent, 3000);
</script>
</body>
</html>

